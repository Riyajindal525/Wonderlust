<% layout("layouts/boilerplate") %>

<body class="bg-light">

  <div class="container mt-5">
    <h2 class="mb-4 text-center">Edit Listing</h2>

    <form action="/listings/<%= listing._id %>?_method=PUT" method="POST" class="card p-4 shadow rounded needs-validation" enctype = "multipart/form-data"novalidate>
      
      <!-- Title -->
      <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <input 
          type="text" 
          id="title" 
          name="title" 
          value="<%= listing.title %>" 
          class="form-control" 
          required>
          <div class = "invalid-feedback">Title is required</div>
          <div class = "valid-feedback">Title looks good</div>
      </div>

      <!-- Description -->
      <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea 
          id="description" 
          name="description" 
          class="form-control" 
          rows="3" required><%= listing.description %></textarea>
          <div class = "invalid-feedback">Description should be valid</div>
          <div class = "valid-feedback">Description is good</div>
      </div>

       <div class="mt-2">
         <label for="originalImageUrl" class="form-label" >Original Image</label>
         <br />
          <img src="<%= listing.image.url %>" alt="Listing Image" class="img-thumbnail" id = "originalImageUrl" width="200">
        </div>
      <br />
      <!-- Image URL -->
      <div class="mb-3">
        <label for="imageUrl" class="form-label" >Upload new Image</label>
        <input 
          type="file" 
          id="imageUrl" 
          name="image.url" 
         class="form-control"
         />

       
      </div>

      <!-- Categories -->
<div class="mb-3">
  <label class="form-label">Categories</label>
  <div class="d-flex flex-wrap gap-3">
    <% const allowedCategories = ['Trending','Farms','Rooms','Mountains','Cities','Beach','Cabins','Lakeside','Views']; %>
    <% allowedCategories.forEach(cat => { %>
      <div class="form-check">
        <input 
          class="form-check-input" 
          type="checkbox" 
          name="categories" 
          value="<%= cat %>" 
          id="cat-<%= cat %>"
          <% if (listing.categories.includes(cat)) { %> checked <% } %>>
        <label class="form-check-label" for="cat-<%= cat %>"><%= cat %></label>
      </div>
    <% }) %>
  </div>
</div>


      <!-- Price -->
      <div class="mb-3">
        <label for="price" class="form-label" required>Price</label>
        <input 
          type="number" 
          id="price" 
          name="price" 
          value="<%= listing.price %>" 
          class="form-control">
          <div class = "invalid-feedback" required>Price is required</div>
           <div class = "valid-feedback">Can increase your price ....ðŸ˜Š</div>
      </div>

      <!-- Location -->
      <div class="mb-3">
        <label for="location" class="form-label" required>Location</label>
        <input 
          type="text" 
          id="location" 
          name="location" 
          value="<%= listing.location %>" 
          class="form-control">
           <div class = "invalid-feedback" required>Enter a valid location</div>
            <div class = "valid-feedback">Location is correct</div>
      </div>

      <!-- Country -->
      <div class="mb-3">
        <label for="country" class="form-label" required>Country</label>
        <input 
          type="text" 
          id="country" 
          name="country" 
          value="<%= listing.country %>" 
          class="form-control">
           <div class = "invalid-feedback" required>Enter a valid country</div>
            <div class = "valid-feedback">Country looks fine</div>
      </div>

      <!-- Buttons -->
      <div class="d-flex justify-content-between">
        <a href="/listings" class="btn btn-secondary">Cancel</a>
        <button type="submit" class="btn btn-primary">Update Listing</button>
      </div>

    </form>
  </div>
   <br />
</body>